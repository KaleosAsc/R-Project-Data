print(languajes)
print(languaje)
language <- unique(Copia_Datos_Limpios$review_language)
print(languaje)
View(Copia_Datos_Limpios)
View(Copia_Datos_Limpios)
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
spam_verified = case_when(
spam_verified == "ham" & is_latin(review_text) ~ "spam", # Marcar como spam si es lat√≠n
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones
)
)
install.packages("httr")
install.packages("jsonlite")
install.packages("cld2")
library(readr)
library(dplyr)
library(httr)
library(jsonlite)
library(purrr)
library(rlang)
library(cld2)
multilingual_mobile_app_reviews_2025 <- read_csv("multilingual_mobile_app_reviews_2025.csv")
View(multilingual_mobile_app_reviews_2025)
# Contar valores vac√≠os en todo el dataset
colSums(is.na(multilingual_mobile_app_reviews_2025))
Copia_Datos_Limpios <- multilingual_mobile_app_reviews_2025
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
select(-review_id, -num_helpful_votes, -user_id, -user_gender, -app_version)
colSums(is.na(Copia_Datos_Limpios))
# Filtro general para cualquier variable
filtro_user_country <- Copia_Datos_Limpios %>% filter(is.na(user_country))
filtro_review_text  <- Copia_Datos_Limpios %>% filter(is.na(review_text))
filtro_rating       <- Copia_Datos_Limpios %>% filter(is.na(rating))
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
user_country = case_when(
review_language == "es" ~ "Spain",          # Spanish
review_language == "pt" ~ "Brazil",         # Portuguese
review_language == "ja" ~ "Japan",          # Japanese
review_language == "hi" ~ "India",          # Hindi
review_language == "ko" ~ "South Korea",    # Korean
review_language == "zh" ~ "China",          # Chinese
review_language == "de" ~ "Germany",        # German
review_language == "fr" ~ "France",         # French
review_language == "it" ~ "Italy",          # Italian
review_language == "ru" ~ "Russia",         # Russian
TRUE ~ user_country                         # Keep original if no match
)
)
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
filter(!is.na(rating))
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
filter(!is.na(review_text))
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
filter(!is.na(user_country))
colSums(is.na(Copia_Datos_Limpios)[, c("user_country", "review_text", "rating")])
sapply(Copia_Datos_Limpios,class)
language <- unique(Copia_Datos_Limpios$review_language)
print(languajes)
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
spam_verified = case_when(
spam_verified == "ham" & is_latin(review_text) ~ "spam", # Marcar como spam si es lat√≠n
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones
)
)
install.packages("httr")
install.packages("jsonlite")
install.packages("cld2")
install.packages("httr")
install.packages("jsonlite")
install.packages("cld2")
library(readr)
library(dplyr)
library(httr)
library(jsonlite)
library(purrr)
library(rlang)
library(cld2)
# Contar valores vac√≠os en todo el dataset
colSums(is.na(multilingual_mobile_app_reviews_2025))
Copia_Datos_Limpios <- multilingual_mobile_app_reviews_2025
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
select(-review_id, -num_helpful_votes, -user_id, -user_gender, -app_version)
colSums(is.na(Copia_Datos_Limpios))
# Filtro general para cualquier variable
filtro_user_country <- Copia_Datos_Limpios %>% filter(is.na(user_country))
filtro_review_text  <- Copia_Datos_Limpios %>% filter(is.na(review_text))
filtro_rating       <- Copia_Datos_Limpios %>% filter(is.na(rating))
# Filtro general para cualquier variable
filtro_user_country <- Copia_Datos_Limpios %>% filter(is.na(user_country))
filtro_review_text  <- Copia_Datos_Limpios %>% filter(is.na(review_text))
filtro_rating       <- Copia_Datos_Limpios %>% filter(is.na(rating))
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
user_country = case_when(
review_language == "es" ~ "Spain",          # Spanish
review_language == "pt" ~ "Brazil",         # Portuguese
review_language == "ja" ~ "Japan",          # Japanese
review_language == "hi" ~ "India",          # Hindi
review_language == "ko" ~ "South Korea",    # Korean
review_language == "zh" ~ "China",          # Chinese
review_language == "de" ~ "Germany",        # German
review_language == "fr" ~ "France",         # French
review_language == "it" ~ "Italy",          # Italian
review_language == "ru" ~ "Russia",         # Russian
TRUE ~ user_country                         # Keep original if no match
)
)
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
filter(!is.na(rating))
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
filter(!is.na(review_text))
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
filter(!is.na(user_country))
colSums(is.na(Copia_Datos_Limpios)[, c("user_country", "review_text", "rating")])
sapply(Copia_Datos_Limpios,class)
language <- unique(Copia_Datos_Limpios$review_language)
print(languajes)
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
spam_verified = case_when(
spam_verified == "ham" & is_latin(review_text) ~ "spam", # Marcar como spam si es lat√≠n
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones
)
)
View(Copia_Datos_Limpios)
language <- unique(Copia_Datos_Limpios$review_language)
print(languajes)
language <- unique(Copia_Datos_Limpios$review_language)
typeof(language)
# Asegurar que review_language sea texto
Copia_Datos_Limpios$review_language <- as.character(Copia_Datos_Limpios$review_language)
# Reemplazar 'zh' por 'zh-Hans' (chino simplificado)
Copia_Datos_Limpios$review_language[Copia_Datos_Limpios$review_language == "zh"] <- "zh-Hans"
# Verificar valores √∫nicos despu√©s de la correcci√≥n
unique(Copia_Datos_Limpios$review_language)
# Asegurar que review_language sea texto
Copia_Datos_Limpios$review_language <- as.character(Copia_Datos_Limpios$review_language)
# Reemplazar 'zh' por 'zh-Hans' (chino simplificado)
Copia_Datos_Limpios$review_language[Copia_Datos_Limpios$review_language == "zh"] <- "zh-Hans"
# Verificar valores √∫nicos despu√©s de la correcci√≥n
unique(Copia_Datos_Limpios$review_language)
translate_review_text <- function(text, target = "en", key, endpoint, region = "global") {
print(text)
if (is.na(text) || nchar(text) == 0) print("Value null")
url <- paste0(endpoint, "translate?api-version=3.0&to=", target)
body <- list(list(Text = text))
response <- POST(
url,
add_headers(
`Ocp-Apim-Subscription-Key` = key,
`Ocp-Apim-Subscription-Region` = region,
`Content-Type` = "application/json"
),
body = toJSON(body, auto_unbox = TRUE)
)
# Manejo de errores
if (status_code(response) != 200) {
warning(paste("Error:", content(response, "text", encoding = "UTF-8")))
return(NA_character_)
}
result <- fromJSON(content(response, as = "text", encoding = "UTF-8"))
# cat("üì¶ Resultado bruto de la API:\n",
#   jsonlite::toJSON(result, pretty = TRUE, auto_unbox = TRUE),
#   "\n\n")
# str(result)
translated_text <- result$translations[[1]]$text
# cat("‚úÖ Traducido:", translated_text, "\n\n--- Fin impresi√≥n OK ---\n\n")
return(translated_text)
}
# --- Configuraci√≥n Azure ---
endpoint <- "https://api.cognitive.microsofttranslator.com/"
region <- "global"
# --- Subconjunto de prueba ---
# Copia_Datos_Limpios_test <- head(Copia_Datos_Limpios, 10)
# --- Aplicar traducci√≥n solo sobre las columnas necesarias ---
Copia_Datos_Limpios$translated <- pmap_chr(
list(Copia_Datos_Limpios$review_text),
function(review_text) {
response <- translate_review_text(
text = review_text,
target = "en",
key = key,
endpoint = endpoint,
region = region
)
if (is.null(response) || length(response) == 0) {
return(NA_character_)
} else {
print(response)  # para ver progreso
return(enc2utf8(as.character(response)))
}
}
)
translate_review_text <- function(text, target = "en", key, endpoint, region = "global") {
print(text)
if (is.na(text) || nchar(text) == 0) print("Value null")
url <- paste0(endpoint, "translate?api-version=3.0&to=", target)
body <- list(list(Text = text))
response <- POST(
url,
add_headers(
`Ocp-Apim-Subscription-Key` = key,
`Ocp-Apim-Subscription-Region` = region,
`Content-Type` = "application/json"
),
body = toJSON(body, auto_unbox = TRUE)
)
# Manejo de errores
if (status_code(response) != 200) {
warning(paste("Error:", content(response, "text", encoding = "UTF-8")))
return(NA_character_)
}
result <- fromJSON(content(response, as = "text", encoding = "UTF-8"))
# cat("üì¶ Resultado bruto de la API:\n",
#   jsonlite::toJSON(result, pretty = TRUE, auto_unbox = TRUE),
#   "\n\n")
# str(result)
translated_text <- result$translations[[1]]$text
# cat("‚úÖ Traducido:", translated_text, "\n\n--- Fin impresi√≥n OK ---\n\n")
return(translated_text)
}
translate_review_text <- function(text, target = "en", key, endpoint, region = "global") {
print(text)
if (is.na(text) || nchar(text) == 0) print("Value null")
url <- paste0(endpoint, "translate?api-version=3.0&to=", target)
body <- list(list(Text = text))
response <- POST(
url,
add_headers(
`Ocp-Apim-Subscription-Key` = key,
`Ocp-Apim-Subscription-Region` = region,
`Content-Type` = "application/json"
),
body = toJSON(body, auto_unbox = TRUE)
)
# Manejo de errores
if (status_code(response) != 200) {
warning(paste("Error:", content(response, "text", encoding = "UTF-8")))
return(NA_character_)
}
result <- fromJSON(content(response, as = "text", encoding = "UTF-8"))
# cat("üì¶ Resultado bruto de la API:\n",
#   jsonlite::toJSON(result, pretty = TRUE, auto_unbox = TRUE),
#   "\n\n")
# str(result)
translated_text <- result$translations[[1]]$text
# cat("‚úÖ Traducido:", translated_text, "\n\n--- Fin impresi√≥n OK ---\n\n")
return(translated_text)
}
translate_review_text <- function(text, target = "en", key, endpoint, region = "global") {
print(text)
if (is.na(text) || nchar(text) == 0) print("Value null")
url <- paste0(endpoint, "translate?api-version=3.0&to=", target)
body <- list(list(Text = text))
response <- POST(
url,
add_headers(
`Ocp-Apim-Subscription-Key` = key,
`Ocp-Apim-Subscription-Region` = region,
`Content-Type` = "application/json"
),
body = toJSON(body, auto_unbox = TRUE)
)
# Manejo de errores
if (status_code(response) != 200) {
warning(paste("Error:", content(response, "text", encoding = "UTF-8")))
return(NA_character_)
}
result <- fromJSON(content(response, as = "text", encoding = "UTF-8"))
# cat("üì¶ Resultado bruto de la API:\n",
#   jsonlite::toJSON(result, pretty = TRUE, auto_unbox = TRUE),
#   "\n\n")
# str(result)
translated_text <- result$translations[[1]]$text
# cat("‚úÖ Traducido:", translated_text, "\n\n--- Fin impresi√≥n OK ---\n\n")
return(translated_text)
}
translate_review_text <- function(text, target = "en", key, endpoint, region = "global") {
print(text)
if (is.na(text) || nchar(text) == 0) print("Value null")
url <- paste0(endpoint, "translate?api-version=3.0&to=", target)
body <- list(list(Text = text))
response <- POST(
url,
add_headers(
`Ocp-Apim-Subscription-Key` = key,
`Ocp-Apim-Subscription-Region` = region,
`Content-Type` = "application/json"
),
body = toJSON(body, auto_unbox = TRUE)
)
# Manejo de errores
if (status_code(response) != 200) {
warning(paste("Error:", content(response, "text", encoding = "UTF-8")))
return(NA_character_)
}
result <- fromJSON(content(response, as = "text", encoding = "UTF-8"))
# cat("üì¶ Resultado bruto de la API:\n",
#   jsonlite::toJSON(result, pretty = TRUE, auto_unbox = TRUE),
#   "\n\n")
# str(result)
translated_text <- result$translations[[1]]$text
# cat("‚úÖ Traducido:", translated_text, "\n\n--- Fin impresi√≥n OK ---\n\n")
return(translated_text)
}
# --- Configuraci√≥n Azure ---
endpoint <- "https://api.cognitive.microsofttranslator.com/"
region <- "global"
# --- Subconjunto de prueba ---
# Copia_Datos_Limpios_test <- head(Copia_Datos_Limpios, 10)
# --- Aplicar traducci√≥n solo sobre las columnas necesarias ---
Copia_Datos_Limpios$translated <- pmap_chr(
list(Copia_Datos_Limpios$review_text),
function(review_text) {
response <- translate_review_text(
text = review_text,
target = "en",
key = key,
endpoint = endpoint,
region = region
)
if (is.null(response) || length(response) == 0) {
return(NA_character_)
} else {
print(response)  # para ver progreso
return(enc2utf8(as.character(response)))
}
}
)
# --- Configuraci√≥n Azure ---
endpoint <- "https://api.cognitive.microsofttranslator.com/"
region <- "global"
# --- Subconjunto de prueba ---
# Copia_Datos_Limpios_test <- head(Copia_Datos_Limpios, 10)
# --- Aplicar traducci√≥n solo sobre las columnas necesarias ---
Copia_Datos_Limpios$translated <- pmap_chr(
list(Copia_Datos_Limpios$review_text),
function(review_text) {
response <- translate_review_text(
text = review_text,
target = "en",
key = key,
endpoint = endpoint,
region = region
)
if (is.null(response) || length(response) == 0) {
return(NA_character_)
} else {
print(response)  # para ver progreso
return(enc2utf8(as.character(response)))
}
}
)
install.packages("dotenv")
# --- Configuraci√≥n Azure ---
endpoint <- "https://api.cognitive.microsofttranslator.com/"
region <- "global"
# --- Subconjunto de prueba ---
# Copia_Datos_Limpios_test <- head(Copia_Datos_Limpios, 10)
# --- Aplicar traducci√≥n solo sobre las columnas necesarias ---
Copia_Datos_Limpios$translated <- pmap_chr(
list(Copia_Datos_Limpios$review_text),
function(review_text) {
response <- translate_review_text(
text = review_text,
target = "en",
key = key,
endpoint = endpoint,
region = region
)
if (is.null(response) || length(response) == 0) {
return(NA_character_)
} else {
print(response)  # para ver progreso
return(enc2utf8(as.character(response)))
}
}
)
# --- Configuraci√≥n Azure ---
load_dot_env()
library(dotenv)
# --- Configuraci√≥n Azure ---
load_dot_env()
key <- Sys.getenv("AZURE_KEY")
endpoint <- "https://api.cognitive.microsofttranslator.com/"
region <- "global"
# --- Subconjunto de prueba ---
# Copia_Datos_Limpios_test <- head(Copia_Datos_Limpios, 10)
# --- Aplicar traducci√≥n solo sobre las columnas necesarias ---
Copia_Datos_Limpios$translated <- pmap_chr(
list(Copia_Datos_Limpios$review_text),
function(review_text) {
response <- translate_review_text(
text = review_text,
target = "en",
key = key,
endpoint = endpoint,
region = region
)
if (is.null(response) || length(response) == 0) {
return(NA_character_)
} else {
print(response)  # para ver progreso
return(enc2utf8(as.character(response)))
}
}
)
Copia_Datos_Limpios$is_duplicated <-
duplicated(Copia_Datos_Limpios$translated) |
duplicated(Copia_Datos_Limpios$translated, fromLast = TRUE)
Copia_Datos_Limpios$spam_verified <- ifelse(Copia_Datos_Limpios$is_duplicated, "spam", "ham")
View(Copia_Datos_Limpios)
# Bolsa de palabras v√°lidas para rese√±as
valid_words <- c(
"great", "good", "excellent", "amazing", "love", "helpful", "easy", "fast",
"quality", "recommend", "happy", "satisfied", "improved", "useful", "perfect",
"bad", "terrible", "disappointed", "problem", "issue", "broken", "slow",
"update", "feature", "service", "support", "interface", "design", "experience",
"download", "install", "upgrade", "bug", "error", "crash", "fix", "solution"
)
# Funci√≥n para evaluar si un texto es v√°lido
is_valid_review <- function(text) {
# Manejar valores nulos o vac√≠os
if (is.na(text) || text == "" || nchar(trimws(text)) == 0) {
return(FALSE) # Texto vac√≠o o nulo no es v√°lido
}
# Convertir el texto a min√∫sculas para hacer la comparaci√≥n insensible a may√∫sculas/min√∫sculas
text_lower <- tolower(as.character(text))
# Verificar si alguna palabra v√°lida aparece en el texto
has_valid_word <- any(sapply(valid_words, function(word) grepl(paste0("\\b", word, "\\b"), text_lower)))
return(has_valid_word)
}
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
spam_verified = case_when(
spam_verified != "spam" &
detect_language(translated) == "en" &
is_valid_review(translated) ~ "ham", # Ham si no es spam, est√° en ingl√©s y contiene palabras v√°lidas
spam_verified != "spam" &
detect_language(translated) == "en" &
!is_valid_review(translated) ~ "spam", # Spam si no es spam, est√° en ingl√©s pero no contiene palabras v√°lidas
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones anteriores
)
)
# Funci√≥n para obtener el idioma t√≠pico de un pa√≠s
get_language_from_country <- function(country) {
# Mapeo de pa√≠ses a c√≥digos de idioma (basado en tu lista)
country_to_language <- c(
"China" = "zh-Hans",          # Chino simplificado
"Russia" = "ru",              # Ruso
"Spain" = "es",               # Espa√±ol
"India" = "hi",               # Hindi (tambi√©n podr√≠a ser "en" si se usa ingl√©s com√∫nmente)
"South Korea" = "ko",         # Coreano
"Australia" = "en",           # Ingl√©s
"Japan" = "ja",               # Japon√©s
"France" = "fr",              # Franc√©s
"Italy" = "it",               # Italiano
"Germany" = "de",             # Alem√°n
"Vietnam" = "vi",             # Vietnamita
"Turkey" = "tr",              # Turco
"Thailand" = "th",            # Tailand√©s
"Brazil" = "pt",              # Portugu√©s
"Nigeria" = "en",             # Ingl√©s (oficial y ampliamente usado)
"United States" = "en",       # Ingl√©s
"Bangladesh" = "bn",          # Bengal√≠
"Canada" = "en",              # Ingl√©s (tambi√©n podr√≠a ser "fr" para franc√©s en Quebec)
"Indonesia" = "id",           # Indonesio
"Mexico" = "es",              # Espa√±ol
"Malaysia" = "ms",            # Malayo
"Pakistan" = "ur",            # Urdu (tambi√©n podr√≠a ser "en" si se usa ingl√©s com√∫nmente)
"Philippines" = "fil",        # Filipino
"United Kingdom" = "en"       # Ingl√©s
)
# Devolver el idioma correspondiente al pa√≠s
return(country_to_language[country])
}
# Funci√≥n para detectar el idioma de un texto
detect_language <- function(text) {
if (is.na(text) || text == "") {
return(NA) # Manejar valores nulos o vac√≠os
}
# Detectar el idioma usando cld2
detected <- cld2::detect_language(text)
return(detected) # Devolver el c√≥digo del idioma detectado
}
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
detected_language = sapply(review_text, detect_language), # Detectar el idioma del texto
spam_verified = case_when(
spam_verified == "ham" &
(
review_language != get_language_from_country(user_country) | # Idioma declarado no coincide con el pa√≠s
detected_language != get_language_from_country(user_country) # Idioma detectado no coincide con el pa√≠s
) ~ "spam", # Marcar como spam si no coincide el idioma
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones
)
) %>%
select(-detected_language) # Eliminar columna auxiliar si no es necesaria
unique(Copia_Datos_Limpios$spam_verified)
values_verified <- Copia_Datos_Limpios %>% filter(spam_verified == "ham")
View(values_verified)
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
spam_verified = case_when(
spam_verified == "ham" & is_latin(review_text) ~ "spam", # Marcar como spam si es lat√≠n
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones
)
)
