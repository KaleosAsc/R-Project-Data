endpoint = endpoint,
region = region
)
if (is.null(response) || length(response) == 0) {
return(NA_character_)
} else {
print(response)  # para ver progreso
return(enc2utf8(as.character(response)))
}
}
)
View(Copia_Datos_Limpios)
Copia_Datos_Limpios$spam <- duplicated(Copia_Datos_Limpios$translated | duplicated(Copia_Datos_Limpios$translated, fromLast = TRUE))
Copia_Datos_Limpios$is_duplicated <- duplicated(Copia_Datos_Limpios$translated | duplicated(Copia_Datos_Limpios$translated, fromLast = TRUE))
Copia_Datos_Limpios$is_duplicated <- duplicated(Copia_Datos_Limpios$translated) | duplicated(Copia_Datos_Limpios$translated, fromLast = TRUE))
Copia_Datos_Limpios$is_duplicated <-
duplicated(Copia_Datos_Limpios$translated) |
duplicated(Copia_Datos_Limpios$translated, fromLast = TRUE)
Copia_Datos_Limpios$spam_verified <- ifelse(Copia_Datos_Limpios$is_duplicated, "spam", "ham")
View(Copia_Datos_Limpios)
View(Copia_Datos_Limpios)
str(Copia_Datos_Limpios)
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
spam_verified = case_when(
spam_verified == "ham" & review_language != get_language_from_country(user_country) & is_irrelevant(review_text) ~ "spam",
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones
)
)
unique(Copia_Datos_Limpios$user_country)
unique(Copia_Datos_Limpios$user_country)
union(Copia_Datos_Limpios$review_language)
unique(Copia_Datos_Limpios$user_country)
unique(Copia_Datos_Limpios$review_language)
# Función para obtener el idioma típico de un país
get_language_from_country <- function(country) {
# Mapeo de países a códigos de idioma (basado en tu lista)
country_to_language <- c(
"China" = "zh-Hans",          # Chino simplificado
"Russia" = "ru",              # Ruso
"Spain" = "es",               # Español
"India" = "hi",               # Hindi (también podría ser "en" si se usa inglés comúnmente)
"South Korea" = "ko",         # Coreano
"Australia" = "en",           # Inglés
"Japan" = "ja",               # Japonés
"France" = "fr",              # Francés
"Italy" = "it",               # Italiano
"Germany" = "de",             # Alemán
"Vietnam" = "vi",             # Vietnamita
"Turkey" = "tr",              # Turco
"Thailand" = "th",            # Tailandés
"Brazil" = "pt",              # Portugués
"Nigeria" = "en",             # Inglés (oficial y ampliamente usado)
"United States" = "en",       # Inglés
"Bangladesh" = "bn",          # Bengalí
"Canada" = "en",              # Inglés (también podría ser "fr" para francés en Quebec)
"Indonesia" = "id",           # Indonesio
"Mexico" = "es",              # Español
"Malaysia" = "ms",            # Malayo
"Pakistan" = "ur",            # Urdu (también podría ser "en" si se usa inglés comúnmente)
"Philippines" = "fil",        # Filipino
"United Kingdom" = "en"       # Inglés
)
# Devolver el idioma correspondiente al país
return(country_to_language[country])
}
install.packages("cld2")
library(cld2)
# Función para detectar el idioma de un texto
detect_language <- function(text) {
if (is.na(text) || text == "") {
return(NA) # Manejar valores nulos o vacíos
}
# Detectar el idioma usando cld2
detected <- detectLanguage(text)
return(detected$langs$code[1]) # Devolver el código del idioma detectado
}
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
detected_language = sapply(review_text, detect_language), # Detectar el idioma del texto
spam_verified = case_when(
spam_verified == "ham" &
(
review_language != get_language_from_country(user_country) | # Idioma declarado no coincide con el país
detected_language != get_language_from_country(user_country) # Idioma detectado no coincide con el país
) &
is_irrelevant(review_text) ~ "spam", # Además, el texto debe ser irrelevante
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones
)
) %>%
select(-detected_language) # Eliminar la columna auxiliar si no es necesaria
# Función para detectar el idioma de un texto
detect_language <- function(text) {
if (is.na(text) || text == "") {
return(NA) # Manejar valores nulos o vacíos
}
# Detectar el idioma usando cld2
detected <- detectLanguage(text)
return(detected$langs$code[1]) # Devolver el código del idioma detectado
}
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
detected_language = sapply(review_text, detect_language), # Detectar el idioma del texto
spam_verified = case_when(
spam_verified == "ham" &
(
review_language != get_language_from_country(user_country) | # Idioma declarado no coincide con el país
detected_language != get_language_from_country(user_country) # Idioma detectado no coincide con el país
) &
is_irrelevant(review_text) ~ "spam", # Además, el texto debe ser irrelevante
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones
)
) %>%
select(-detected_language) # Eliminar la columna auxiliar si no es necesaria
library(readr)
library(dplyr)
library(httr)
library(jsonlite)
library(purrr)
library(rlang)
library(cld2)
# Función para detectar el idioma de un texto
detect_language <- function(text) {
if (is.na(text) || text == "") {
return(NA) # Manejar valores nulos o vacíos
}
# Detectar el idioma usando cld2
detected <- detectLanguage(text)
return(detected$langs$code[1]) # Devolver el código del idioma detectado
}
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
detected_language = sapply(review_text, detect_language), # Detectar el idioma del texto
spam_verified = case_when(
spam_verified == "ham" &
(
review_language != get_language_from_country(user_country) | # Idioma declarado no coincide con el país
detected_language != get_language_from_country(user_country) # Idioma detectado no coincide con el país
) &
is_irrelevant(review_text) ~ "spam", # Además, el texto debe ser irrelevante
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones
)
) %>%
select(-detected_language) # Eliminar la columna auxiliar si no es necesaria
# Función para detectar el idioma de un texto
detect_language <- function(text) {
if (is.na(text) || text == "") {
return(NA) # Manejar valores nulos o vacíos
}
# Detectar el idioma usando cld2
detected <- detect_language_mixed(text)
return(detected$langs$code[1]) # Devolver el código del idioma detectado
}
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
detected_language = sapply(review_text, detect_language), # Detectar el idioma del texto
spam_verified = case_when(
spam_verified == "ham" &
(
review_language != get_language_from_country(user_country) | # Idioma declarado no coincide con el país
detected_language != get_language_from_country(user_country) # Idioma detectado no coincide con el país
) &
is_irrelevant(review_text) ~ "spam", # Además, el texto debe ser irrelevante
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones
)
) %>%
select(-detected_language) # Eliminar la columna auxiliar si no es necesaria
detectLanguage("Hello, this is a test.") # Debería devolver "en" (inglés)
library(cld2)
detectLanguage("Hello, this is a test.") # Debería devolver "en" (inglés)
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
detected_language = sapply(review_text, detect_language), # Detectar el idioma del texto
spam_verified = case_when(
spam_verified == "ham" &
(
review_language != get_language_from_country(user_country) | # Idioma declarado no coincide con el país
detected_language != get_language_from_country(user_country) # Idioma detectado no coincide con el país
) &
is_irrelevant(review_text) ~ "spam", # Además, el texto debe ser irrelevante
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones
)
) %>%
select(-detected_language) # Eliminar la columna auxiliar si no es necesaria
# Función para detectar el idioma de un texto
detect_language <- function(text) {
if (is.na(text) || text == "") {
return(NA) # Manejar valores nulos o vacíos
}
# Detectar el idioma usando cld2
detected <- cld2::detect_language(text)
return(detected$langs$code[1]) # Devolver el código del idioma detectado
}
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
detected_language = sapply(review_text, detect_language), # Detectar el idioma del texto
spam_verified = case_when(
spam_verified == "ham" &
(
review_language != get_language_from_country(user_country) | # Idioma declarado no coincide con el país
detected_language != get_language_from_country(user_country) # Idioma detectado no coincide con el país
) &
is_irrelevant(review_text) ~ "spam", # Además, el texto debe ser irrelevante
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones
)
) %>%
select(-detected_language) # Eliminar la columna auxiliar si no es necesaria
# Función para detectar el idioma de un texto
detect_language <- function(text) {
if (is.na(text) || text == "") {
return(NA) # Manejar valores nulos o vacíos
}
# Detectar el idioma usando cld2
detected <- cld2::detect_language(text)
return(detected$language[1]) # Devolver el código del idioma detectado
}
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
detected_language = sapply(review_text, detect_language), # Detectar el idioma del texto
spam_verified = case_when(
spam_verified == "ham" &
(
review_language != get_language_from_country(user_country) | # Idioma declarado no coincide con el país
detected_language != get_language_from_country(user_country) # Idioma detectado no coincide con el país
) &
is_irrelevant(review_text) ~ "spam", # Además, el texto debe ser irrelevante
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones
)
) %>%
select(-detected_language) # Eliminar la columna auxiliar si no es necesaria
# Función para detectar el idioma de un texto
detect_language <- function(text) {
if (is.na(text) || text == "") {
return(NA) # Manejar valores nulos o vacíos
}
# Detectar el idioma usando cld2
detected <- cld2::detect_language_simple(text)
return(detected$language[1]) # Devolver el código del idioma detectado
}
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
detected_language = sapply(review_text, detect_language), # Detectar el idioma del texto
spam_verified = case_when(
spam_verified == "ham" &
(
review_language != get_language_from_country(user_country) | # Idioma declarado no coincide con el país
detected_language != get_language_from_country(user_country) # Idioma detectado no coincide con el país
) &
is_irrelevant(review_text) ~ "spam", # Además, el texto debe ser irrelevante
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones
)
) %>%
select(-detected_language) # Eliminar la columna auxiliar si no es necesaria
# Función para detectar el idioma de un texto
detect_language <- function(text) {
if (is.na(text) || text == "") {
return(NA) # Manejar valores nulos o vacíos
}
# Detectar el idioma usando cld2
detected <- cld2::detect_language(text)
return(detected$language[1]) # Devolver el código del idioma detectado
}
detect_language("Hello, this is a test.")
# Función para detectar el idioma de un texto
detect_language <- function(text) {
if (is.na(text) || text == "") {
return(NA) # Manejar valores nulos o vacíos
}
# Detectar el idioma usando cld2
detected <- cld2::detect_language(text)
return(detected) # Devolver el código del idioma detectado
}
detect_language("Hello, this is a test.")
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
detected_language = sapply(review_text, detect_language), # Detectar el idioma del texto
spam_verified = case_when(
spam_verified == "ham" &
(
review_language != get_language_from_country(user_country) | # Idioma declarado no coincide con el país
detected_language != get_language_from_country(user_country) # Idioma detectado no coincide con el país
) &
is_irrelevant(review_text) ~ "spam", # Además, el texto debe ser irrelevante
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones
)
) %>%
select(-detected_language) # Eliminar la columna auxiliar si no es necesaria
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
detected_language = sapply(review_text, detect_language), # Detectar el idioma del texto
spam_verified = case_when(
spam_verified == "ham" &
(
review_language != get_language_from_country(user_country) | # Idioma declarado no coincide con el país
detected_language != get_language_from_country(user_country) # Idioma detectado no coincide con el país
) &
# Además, el texto debe ser irrelevante
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones
)
) %>%
select(-detected_language) # Eliminar la columna auxiliar si no es necesaria
View(Copia_Datos_Limpios)
Copia_Datos_Limpios$is_duplicated <-
duplicated(Copia_Datos_Limpios$translated) |
duplicated(Copia_Datos_Limpios$translated, fromLast = TRUE)
Copia_Datos_Limpios$spam_verified <- ifelse(Copia_Datos_Limpios$is_duplicated, "spam", "ham")
View(Copia_Datos_Limpios)
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
detected_language = sapply(review_text, detect_language), # Detectar el idioma del texto
spam_verified = case_when(
spam_verified == "ham" &
(
review_language != get_language_from_country(user_country) | # Idioma declarado no coincide con el país
detected_language != get_language_from_country(user_country) # Idioma detectado no coincide con el país
) ~ "spam", # Marcar como spam si no coincide el idioma
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones
)
) %>%
select(-detected_language) # Eliminar columna auxiliar si no es necesaria
View(Copia_Datos_Limpios)
unique(Copia_Datos_Limpios$spam_verified)
unique(Copia_Datos_Limpios$spam_verified)
Copia_Datos_Limpios %>% filter(spam_verified == "spam")
unique(Copia_Datos_Limpios$spam_verified)
values_verified <- Copia_Datos_Limpios %>% filter(spam_verified == "spam")
View(values_verified)
unique(Copia_Datos_Limpios$spam_verified)
values_verified <- Copia_Datos_Limpios %>% filter(spam_verified == "ham")
View(values_verified)
Copia_Datos_Limpios$is_duplicated <-
duplicated(Copia_Datos_Limpios$translated) |
duplicated(Copia_Datos_Limpios$translated, fromLast = TRUE)
Copia_Datos_Limpios$spam_verified <- ifelse(Copia_Datos_Limpios$is_duplicated, "spam", "ham")
View(Copia_Datos_Limpios)
unique(Copia_Datos_Limpios$spam_verified)
values_verified <- Copia_Datos_Limpios %>% filter(spam_verified == "ham")
View(values_verified)
detect_language(Eius odio facilis fuga distinctio eaque. )
detect_language(Eius odio facilis fuga distinctio eaque.)
detect_language("Eius odio facilis fuga distinctio eaque.")
# Función para detectar si un texto es latín
is_latin <- function(text) {
# Manejar valores nulos o vacíos
if (is.na(text) || text == "" || nchar(trimws(text)) == 0) {
return(FALSE) # Considerar texto vacío como no latín
}
# Lista de palabras clave y sufijos típicos del latín
latin_keywords <- c(
"quis", "doloribus", "consequuntur", "perspiciatis",
"tempora", "assumenda", "atque", "doloremque",
"nobis", "voluptatem", "quidem", "esse"
)
latin_suffixes <- c(
"us", "is", "um", "ae", "am", "ibus", "i", "o"
)
# Convertir el texto a minúsculas para hacer la comparación insensible a mayúsculas/minúsculas
text_lower <- tolower(as.character(text))
# Verificar si alguna palabra clave aparece en el texto
has_keywords <- any(sapply(latin_keywords, function(kw) grepl(kw, text_lower)))
# Verificar si el texto contiene sufijos típicos del latín
has_suffixes <- any(sapply(latin_suffixes, function(suffix) grepl(paste0("\\b\\w*", suffix, "\\b"), text_lower)))
# Si cumple con cualquiera de las condiciones, asumimos que es latín
return(has_keywords || has_suffixes)
}
is_latin(Nulla ullam quo iure repudiandae.)
is_latin("Nulla ullam quo iure repudiandae.")
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
spam_verified = case_when(
spam_verified == "ham" & is_latin(review_text) ~ "spam", # Marcar como spam si es latín
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones
)
)
## Función para detectar si un texto es latín (vectorizada)
is_latin <- function(text) {
# Manejar valores nulos o vacíos (vectorizado)
if (all(is.na(text)) || all(text == "") || all(nchar(trimws(text)) == 0)) {
return(rep(FALSE, length(text))) # Devolver un vector de FALSE del mismo tamaño
}
# Lista de palabras clave y sufijos típicos del latín
latin_keywords <- c(
"quis", "doloribus", "consequuntur", "perspiciatis",
"tempora", "assumenda", "atque", "doloremque",
"nobis", "voluptatem", "quidem", "esse"
)
latin_suffixes <- c(
"us", "is", "um", "ae", "am", "ibus", "i", "o"
)
# Convertir el texto a minúsculas para hacer la comparación insensible a mayúsculas/minúsculas
text_lower <- tolower(as.character(text))
# Verificar si alguna palabra clave aparece en el texto (vectorizado)
has_keywords <- sapply(text_lower, function(txt) {
any(sapply(latin_keywords, function(kw) grepl(kw, txt)))
})
# Verificar si el texto contiene sufijos típicos del latín (vectorizado)
has_suffixes <- sapply(text_lower, function(txt) {
any(sapply(latin_suffixes, function(suffix) grepl(paste0("\\b\\w*", suffix, "\\b"), txt)))
})
# Combinar las condiciones (vectorizado)
return(has_keywords | has_suffixes)
}
is_latin("Nulla ullam quo iure repudiandae.")
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
spam_verified = case_when(
spam_verified == "ham" & is_latin(review_text) ~ "spam", # Marcar como spam si es latín
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones
)
)
unique(Copia_Datos_Limpios$spam_verified)
values_verified <- Copia_Datos_Limpios %>% filter(spam_verified == "ham")
View(values_verified)
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
detected_language = sapply(review_text, detect_language), # Detectar el idioma del texto
spam_verified = case_when(
spam_verified == "ham" &
(
review_language != get_language_from_country(user_country) | # Idioma declarado no coincide con el país
detected_language != get_language_from_country(user_country) # Idioma detectado no coincide con el país
) ~ "spam", # Marcar como spam si no coincide el idioma
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones
)
) %>%
select(-detected_language) # Eliminar columna auxiliar si no es necesaria
unique(Copia_Datos_Limpios$spam_verified)
values_verified <- Copia_Datos_Limpios %>% filter(spam_verified == "ham")
View(values_verified)
Copia_Datos_Limpios$is_duplicated <-
duplicated(Copia_Datos_Limpios$translated) |
duplicated(Copia_Datos_Limpios$translated, fromLast = TRUE)
Copia_Datos_Limpios$spam_verified <- ifelse(Copia_Datos_Limpios$is_duplicated, "spam", "ham")
View(Copia_Datos_Limpios)
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
spam_verified = case_when(
spam_verified == "ham" & is_latin(review_text) ~ "spam", # Marcar como spam si es latín
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones
)
)
unique(Copia_Datos_Limpios$spam_verified)
values_verified <- Copia_Datos_Limpios %>% filter(spam_verified == "ham")
View(values_verified)
Copia_Datos_Limpios$is_duplicated <-
duplicated(Copia_Datos_Limpios$translated) |
duplicated(Copia_Datos_Limpios$translated, fromLast = TRUE)
Copia_Datos_Limpios$spam_verified <- ifelse(Copia_Datos_Limpios$is_duplicated, "spam", "ham")
View(Copia_Datos_Limpios)
# Bolsa de palabras válidas para reseñas
valid_words <- c(
"great", "good", "excellent", "amazing", "love", "helpful", "easy", "fast",
"quality", "recommend", "happy", "satisfied", "improved", "useful", "perfect",
"bad", "terrible", "disappointed", "problem", "issue", "broken", "slow",
"update", "feature", "service", "support", "interface", "design", "experience",
"download", "install", "upgrade", "bug", "error", "crash", "fix", "solution"
)
# Función para evaluar si un texto es válido
is_valid_review <- function(text) {
# Manejar valores nulos o vacíos
if (is.na(text) || text == "" || nchar(trimws(text)) == 0) {
return(FALSE) # Texto vacío o nulo no es válido
}
# Convertir el texto a minúsculas para hacer la comparación insensible a mayúsculas/minúsculas
text_lower <- tolower(as.character(text))
# Verificar si alguna palabra válida aparece en el texto
has_valid_word <- any(sapply(valid_words, function(word) grepl(paste0("\\b", word, "\\b"), text_lower)))
return(has_valid_word)
}
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
spam_verified = case_when(
is_valid_review(review_text) ~ "ham", # Clasificar como ham si contiene palabras válidas
TRUE ~ "spam" # Clasificar como spam si no contiene palabras válidas
)
)
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
spam_verified = case_when(
is_valid_review(translated) ~ "ham", # Clasificar como ham si contiene palabras válidas
TRUE ~ "spam" # Clasificar como spam si no contiene palabras válidas
)
)
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
spam_verified = case_when(
spam_verified != "spam" & detect_language(translated) == "en" & is_valid_review(translated) ~ "ham", # Ham si no es spam, está en inglés y contiene palabras válidas
spam_verified != "spam" & detect_language(translated) == "en" & !is_valid_review(translated) ~ "spam", # Spam si no es spam, está en inglés pero no contiene palabras válidas
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones anteriores
)
)
Copia_Datos_Limpios <- Copia_Datos_Limpios %>%
mutate(
spam_verified = case_when(
spam_verified != "spam" &
detect_language(translated) == "en" &
is_valid_review(translated) ~ "ham", # Ham si no es spam, está en inglés y contiene palabras válidas
spam_verified != "spam" &
detect_language(translated) == "en" &
!is_valid_review(translated) ~ "spam", # Spam si no es spam, está en inglés pero no contiene palabras válidas
TRUE ~ spam_verified # Mantener el valor original si no se cumplen las condiciones anteriores
)
)
View(Copia_Datos_Limpios_test)
View(Copia_Datos_Limpios_test)
View(Copia_Datos_Limpios_test)
View(Copia_Datos_Limpios_test)
View(Copia_Datos_Limpios_test)
View(batch)
View(values_verified)
View(Copia_Datos_Limpios)
install.packages("dotenv")
